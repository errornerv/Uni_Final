<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Management Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #live-output {
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .module-button {
            transition: all 0.2s ease-in-out;
        }
        .module-button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4">
        <h1 class="text-2xl font-bold">Traffic Management Dashboard</h1>
    </header>

    <!-- Run Project Button -->
    <div class="container mx-auto p-4">
        <button id="run-project" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition" onclick="runProject()">
            Run Project
        </button>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto p-4 flex flex-col md:flex-row">
        <!-- Sidebar -->
        <aside class="w-full md:w-1/4 bg-white p-4 rounded-lg shadow-md mb-4 md:mb-0">
            <h2 class="text-xl font-semibold mb-4">Navigation</h2>
            <ul class="space-y-2">
                <li><a href="/" class="text-blue-500 hover:underline">Home</a></li>
                <li><a href="/report" class="text-blue-500 hover:underline">Reports</a></li>
            </ul>
        </aside>

        <!-- Main Content Area -->
        <main class="w-full md:w-3/4 md:ml-4 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Execute Modules</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <!-- Module Buttons -->
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code01')">Run Code 01: Initial Data</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code02')">Run Code 02: Congestion Detection</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code03')">Run Code 03: Managed Traffic</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code04')">Run Code 04: New Orders</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code05')">Run Code 05: Real-Time Orders</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code06')">Run Code 06: Data Preparation</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code07')">Run Code 07: Model Training</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code08')">Run Code 08: Advanced Report</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code09')">Run Code 09: Smart Traffic</button>
                <button class="module-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600" onclick="runModule('code10')">Run Code 10: Self-Healing</button>
                <button class="module-button bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600" onclick="runModule('code11')">Run Code 11: Resource Optimization</button>
                <button class="module-button bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600" onclick="runModule('code12')">Run Code 12: Predictive Analysis</button>
            </div>

            <!-- Live Output -->
            <h2 class="text-xl font-semibold mb-4">Live Output</h2>
            <div id="live-output" class="bg-gray-800 text-white p-4 rounded-lg"></div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        let socket = null;

        function connectSocketIO() {
            socket = io.connect('http://' + window.location.host, {
                reconnection: true,
                reconnectionDelay: 1000
            });

            socket.on('connect', function() {
                const outputDiv = document.getElementById('live-output');
                outputDiv.innerHTML += 'Connected to SocketIO server<br>';
                outputDiv.scrollTop = outputDiv.scrollHeight;
            });

            socket.on('output', function(data) {
                const outputDiv = document.getElementById('live-output');
                outputDiv.innerHTML += data + '<br>';
                outputDiv.scrollTop = outputDiv.scrollHeight;
            });

            socket.on('disconnect', function() {
                const outputDiv = document.getElementById('live-output');
                outputDiv.innerHTML += 'SocketIO connection closed. Reconnecting...<br>';
            });

            socket.on('connect_error', function(error) {
                const outputDiv = document.getElementById('live-output');
                outputDiv.innerHTML += 'SocketIO connection error: ' + error + '<br>';
            });
        }

        function runProject() {
            document.getElementById('run-project').style.display = 'none';
            fetch('/run_project', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status !== 'started') {
                        document.getElementById('run-project').style.display = 'block';
                    }
                });
            connectSocketIO();
        }

        function runModule(code) {
            document.getElementById('live-output').innerHTML = '';
            fetch(`/run_module/${code}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'started') {
                        connectSocketIO();
                    }
                });
        }

        // اتصال اولیه
        connectSocketIO();
    </script>
</body>
</html>